<!DOCTYPE html>
<html class=" js csstransforms3d" xmlns:th="http://www.w3.org/1999/xhtml"><head>
	<meta charset="utf-8">
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>文章发布</title>
	<link rel="stylesheet" href="/css/base.css">
	<link rel="stylesheet" href="/css/page.css">
	<!--[if lte IE 8]>
	<link href="/css/ie8.css" rel="stylesheet" type="text/css"/>
	<![endif]-->

	<script type="text/javascript" src="/js/jquery.min.js"></script>
	<script type="text/javascript" src="/js/main.js"></script>
	<script type="text/javascript" src="/js/modernizr.js"></script>
	<!--[if IE]>
	<script src="http://libs.useso.com/js/html5shiv/3.7/html5shiv.min.js"></script>

	<![endif]-->
</head>

<body style="background: #f6f5fa;">

	<!--content S-->
	<div class="super-content RightMain" id="RightMain">
		
		<!--header-->
		<div class="superCtab">
			<div class="ctab-title clearfix"><h3>文章发布</h3><a href="javascript:;" class="sp-column"><i class="ico-mng"></i>栏目管理</a></div>
			
			<div class="ctab-Main">
				<div class="ctab-Main-title">
					<ul class="clearfix">
						<li class="cur"><a href="wenzhang_xinwen.html">新闻动态</a></li>
						<li><a href="wenzhang_aboutus.html">添加新闻</a></li>
						
					</ul>
				</div>
				
				<div class="ctab-Mian-cont">
					<div class="Mian-cont-btn clearfix">
						<div class="operateBtn">
							<a href="wenzhang_xinwen_fabu.html" class="greenbtn publish">发布文章</a>
							<a href="javascript:;" class="greenbtn add sp-add">添加分类</a>

							<!--<a href="javascript:;" class="modify sp-modify" id="sp-modify">修改</a>-->
						</div>
						<div class="searchBar">
							<input type="text" id="" value="" class="form-control srhTxt" placeholder="输入标题关键字搜索">
							<input type="button" class="srhBtn" value="">
						</div>
					</div>
					<div id="cate" class="super-label clearfix">

					</div>
					
					<div class="Mian-cont-wrap">
						<div class="defaultTab-T">
							<table border="0" cellspacing="0" cellpadding="0" class="defaultTable">
								<tbody><tr><th class="t_1">文章ID</th><th class="t_2">文章标题</th><th class="t_3">发布时间</th><th class="t_4">操作</th></tr>
							</tbody></table>
						</div>
						<table border="0" cellspacing="0" cellpadding="0" class="defaultTable defaultTable2">
							<tbody id="newstbody">
							<!--<tr>-->
								<!--<td class="t_1">0</td>-->
								<!--<td class="t_2"><a href="#">平安好医生与平安银行开启全面战略合作</a></td>-->
								<!--<td class="t_3">2015-12-01</td>-->
								<!--<td class="t_4"><div class="btn"><a href="#" class="modify">修改</a><a href="#" class="delete">删除</a></div></td>-->
							<!--</tr>-->



						</tbody></table>
						<!--pages S-->
						<div class="pageSelect">
							<span> 每页 <b>10</b>条 </span>
							<div class="pageWrap">
								<a class="pagePre" href="javascript:de()"><i class="ico-pre">&nbsp;</i></a>
								<a id="page1" href="javascript:changePage(1)" class="pagenumb cur">1</a>
								<a id="page2" href="javascript:changePage(2)" class="pagenumb">2</a>
								<a id="page3" href="javascript:changePage(3)" class="pagenumb">3</a>
								<a href="javascript:add()" class="pagenext"><i class="ico-next">&nbsp;</i></a>
							</div>
						</div>
						<!--pages E-->
					</div>
				
				</div>
			</div>
		</div>
		<!--main-->
		
	</div>
	<!--content E-->
	
	<div class="layuiBg"></div><!--公共遮罩-->
	<!--点击修改弹出层-->
	<div class="imgXgbox layuiBox">
		<div class="layer-title clearfix"><h2>修改新闻图片</h2><span class="layerClose"></span></div>
		<div class="layer-content">
			<div class="XgfileImg"><img id="Newsimg" src="images/img_xc_bg.jpg"><input id="fileImage" class="fileImageSlect" type="file" size="30" name="file"></div>
			<p class="onclktip" id="click">（点击图片可重新上传）</p><input type="button" value="上传" class="" id="upload" style="height: 20px; width:50px; margin-left: 240px;background-color: #00a2d4 ">
			<div class="Xgimglink clearfix"><span>标题：</span><input id="title" type="text" value=""></div>
			<div class="Xgimglink clearfix"><span>正文：</span><input id="texts" type="text" value="" style="height: 100px"></div>
			<!--<div class="Xgimglink clearfix"><span>分类：</span><input id="category" type="text" value=""></div>-->
			<div class="pubselect" style="align-items: center;margin-left: 180px">
							<span class="select_ui" style="align-items: center;text-align: center;"><span class="select_text_ui" style="min-width: 6em;">请选择分类</span><b class="select_arrow"></b><select name="categoryId" id="categoryId" style="padding-left: 10px">
								<!--<option value="1">首页</option>-->

							</select></span>
			</div>
			<div class="XgBtn"><input type="button" value="保存" class="saveBtn" id="updateNews"></div>
		</div>
	</div>
	<!--点击添加分类弹出-->
	<div class="addFeileibox layuiBox">
		<div class="layer-title clearfix"><h2>添加分类</h2><span class="layerClose"></span></div>
		<div class="layer-content">
			<div class="aFllink clearfix"><span>上级栏目：</span><h5>新闻</h5></div>
			<div class="aFllink clearfix"><span>分类：</span><input type="text" value="" id="catenew"></div>
			<div class="aFlBtn"><input type="button" value="保存" class="saveBtn" id="savecate"></div>
		</div>
	</div>
	<!--栏目管理-->
	<div class="Columnbox layuiBox">
		<div class="layer-title clearfix"><h2>栏目管理</h2><span class="layerClose"></span></div>
		<div class="layer-content">
			<ul class="colu-title clearfix">
				<li class="li-1">栏目名称</li><li class="li-2">英文名称</li><li class="li-3">操作</li><li class="li-4">同步开关</li>
			</ul>
			<div class="colu-list">
				<ul class="colu-cont clearfix active">
					<li class="li-1"><i class="ico"></i>新闻动态</li><li class="li-2">life</li><li class="li-3"><a href="javascript:;" class="colu-xg" data-id="xg1">修改</a></li><li class="li-4"><input type="checkbox" id="checkbox_d1" class="chk_4"><label for="checkbox_d1"></label></li>
				</ul>
				<div class="colunext" style="display: block;">
					<ul class="colu-next clearfix">
						<li class="li-1"><i class="ico"></i>行业新闻</li><li class="li-2"></li><li class="li-3"><a href="javascript:;" class="colu-xg" data-id="xg2">修改</a></li>
					</ul>
					<ul class="colu-next clearfix">
						<li class="li-1"><i class="ico"></i>行业新闻</li><li class="li-2"></li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li>
					</ul>
				</div>
			</div><!--新闻动态-->
			<div class="colu-list">
				<ul class="colu-cont clearfix">
					<li class="li-1"><i class="ico"></i>品尚生活</li><li class="li-2">news</li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li><li class="li-4"><input type="checkbox" id="checkbox_d2" class="chk_4"><label for="checkbox_d2"></label></li>
				</ul>
				<div class="colunext">
					<ul class="colu-next clearfix">
						<li class="li-1"><i class="ico"></i>行业新闻</li><li class="li-2"></li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li>
					</ul>
					<ul class="colu-next clearfix">
						<li class="li-1"><i class="ico"></i>行业新闻</li><li class="li-2"></li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li>
					</ul>
				</div>
			</div><!--品尚生活-->
			<div class="colu-list">
				<ul class="colu-cont clearfix">
					<li class="li-1"><i class="ico"></i>卓越联盟</li><li class="li-2">allance</li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li><li class="li-4"><input type="checkbox" id="checkbox_d3" class="chk_4"><label for="checkbox_d3"></label></li>
				</ul>
				<div class="colunext">
					<ul class="colu-next clearfix">
						<li class="li-1"><i class="ico"></i>行业新闻</li><li class="li-2"></li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li>
					</ul>
					<ul class="colu-next clearfix">
						<li class="li-1"><i class="ico"></i>行业新闻</li><li class="li-2"></li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li>
					</ul>
				</div>
			</div><!--卓越联盟-->
			<div class="colu-list">
				<ul class="colu-cont clearfix">
					<li class="li-1"><i class="ico"></i>招贤纳士</li><li class="li-2">managers</li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li><li class="li-4"><input type="checkbox" id="checkbox_d4" class="chk_4" checked=""><label for="checkbox_d4"></label></li>
				</ul>
				<div class="colunext">
					<ul class="colu-next clearfix">
						<li class="li-1"><i class="ico"></i>行业新闻</li><li class="li-2"></li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li>
					</ul>
					<ul class="colu-next clearfix">
						<li class="li-1"><i class="ico"></i>行业新闻</li><li class="li-2"></li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li>
					</ul>
				</div>
			</div><!--招贤纳士-->
			<div class="colu-list">
				<ul class="colu-cont clearfix">
					<li class="li-1"><i class="ico"></i>客户见证</li><li class="li-2">witness</li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li><li class="li-4"><input type="checkbox" id="checkbox_d5" class="chk_4" checked=""><label for="checkbox_d5"></label></li>
				</ul>
				<div class="colunext">
					<ul class="colu-next clearfix">
						<li class="li-1"><i class="ico"></i>行业新闻</li><li class="li-2"></li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li>
					</ul>
					<ul class="colu-next clearfix">
						<li class="li-1"><i class="ico"></i>行业新闻</li><li class="li-2"></li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li>
					</ul>
				</div>
			</div><!--客户见证-->
			<div class="colu-list">
				<ul class="colu-cont clearfix">
					<li class="li-1"><i class="ico"></i>热门产品</li><li class="li-2">product</li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li><li class="li-4"><input type="checkbox" id="checkbox_d6" class="chk_4" checked=""><label for="checkbox_d6"></label></li>
				</ul>
				<div class="colunext">
					<ul class="colu-next clearfix">
						<li class="li-1"><i class="ico"></i>行业新闻</li><li class="li-2"></li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li>
					</ul>
					<ul class="colu-next clearfix">
						<li class="li-1"><i class="ico"></i>行业新闻</li><li class="li-2"></li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li>
					</ul>
				</div>
			</div><!--热门产品-->
			<div class="colu-list">
				<ul class="clearfix colu-cont-no">
					<li class="li-1"><i class="ico"></i>关于我们</li><li class="li-2">about</li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li><li class="li-4"></li>
				</ul>
			</div><!--关于我们-->
			<div class="colu-list">
				<ul class="clearfix colu-cont-no">
					<li class="li-1"><i class="ico"></i>联系方式</li><li class="li-2">contact</li><li class="li-3"><a href="javascript:;" class="colu-xg">修改</a></li><li class="li-4"></li>
				</ul>
			</div><!--联系方式-->
			
		</div>
	</div>
	<!--栏目管理－修改-->
	<div class="ColumnXgbox layuiBox">
		<div class="layer-title clearfix"><h2>添加分类</h2><span class="layerClose"></span></div>
		<div class="layer-content">
			<div class="aFllink clearfix"><span>修改名称：</span><input type="text" value=""></div>
			<div class="aFllink clearfix"><span>英文名称：</span><input type="text" value=""></div>
			<div class="aFlBtn"><input type="button" value="保存" class="saveBtn"></div>
		</div>
	</div>



<script type="text/javascript" src="/js/zxxFile.js"></script>
<script>
var params = {
	fileInput: $("#fileImage").get(0),
	upButton: $("#fileSubmit").get(0),
	url: $("#uploadForm").attr("action"),
	filter: function(files) {
		var arrFiles = [];
		for (var i = 0, file; file = files[i]; i++) {
			if (file.type.indexOf("image") == 0) {
				if (file.size >= 512000) {
					alert('您这张"'+ file.name +'"图片大小过大，应小于500k');	
				} else {
					arrFiles.push(file);	
				}			
			} else {
				alert('文件"' + file.name + '"不是图片。');	
			}
		}
		return arrFiles;
	},
	onSelect: function(files) {
		var html = '', i = 0;
		$("#preview").html('<div class="upload_loading"></div>');
		var funAppendImage = function() {
			file = files[i];
			if (file) {
				var reader = new FileReader()
				reader.onload = function(e) {
					$('.XgfileImg img').attr('src', e.target.result);
					$('.sp-photo').addClass('cur');
					html = html + '<div id="uploadList_'+ i +'" class="upload_append_list"><p><span>' + file.name + '</span>'+ 
						'<a href="javascript:" class="upload_delete" title="删除" data-index="'+ i +'">删除</a>' +
					'</div>';
					
					i++;
					funAppendImage();
				}
				reader.readAsDataURL(file);
			} else {
				$("#preview").html(html);
				if (html) {
					//删除方法
					$(".upload_delete").click(function() {
						ZXXFILE.funDeleteFile(files[parseInt($(this).attr("data-index"))]);
						$('.sp-photo').removeClass('cur').html('栏目图片');
						return false;	
					});
					//提交按钮显示
					$("#fileSubmit").show();	
				} else {
					//提交按钮隐藏
					$("#fileSubmit").hide();	
				}
			}
		};
		funAppendImage();		
	},
	onDelete: function(file) {
		$("#uploadList_" + file.index).fadeOut();
	},
	onDragOver: function() {
		$(this).addClass("upload_drag_hover");
	},
	onDragLeave: function() {
		$(this).removeClass("upload_drag_hover");
	},
	onProgress: function(file, loaded, total) {
		var eleProgress = $("#uploadProgress_" + file.index), percent = (loaded / total * 100).toFixed(2) + '%';
		eleProgress.show().html(percent);
	},
	onSuccess: function(file, response) {
		$("#uploadInf").append("<p>上传成功，图片地址是：" + response + "</p>");
	},
	onFailure: function(file) {
		$("#uploadInf").append("<p>图片" + file.name + "上传失败！</p>");	
		$("#uploadImage_" + file.index).css("opacity", 0.2);
	},
	onComplete: function() {
		//提交按钮隐藏
		$("#fileSubmit").hide();
		//file控件value置空
		$("#fileImage").val("");
		$("#uploadInf").append("<p>当前图片全部上传完毕，可继续添加上传。</p>");
	}
};
ZXXFILE = $.extend(ZXXFILE, params);
ZXXFILE.init();

</script>

	<script th:inline="javascript">

		var categoryID=1;
		var Page=0;
		var pageSize=10;
       $(document).ready( function() {
           fetch("/news/newslist?pageNum="+Page+"&pageSize="+pageSize+"&categoryId="+categoryID+"").then(function (response) {
               return response.json().then(function (json) {
                   console.log(json[0].content)
                   for (i = 0; i < json.length; i++) {

                       var t=json[i].title
					   var c=json[i].content
					   var url=json[i].url
                       // do something more...
                       $("#newstbody").append("<tr>" +
                           "<td class='t_1'>" + json[i].id + "</td>" +
                           "<td class='t_2'><a href=''>" + json[i].title + "</a></td>" +
                           "<td class='t_3'>2017-9-01</td>" +
                           "<td class='t_4'><div class='btn'><a href='javascript:changeNews("+JSON.stringify(json[i])+");' class='delete'>修改</a><a href='javascript:deletenews("+json[i].id+")'class='delete'>删除</a></div></td>" +
                           " </tr>"
                       )
                   }
               });
           })

       })



       $(document).ready( function() {
           fetch("/category/categoryList").then(function (response) {
               return response.json().then(function (json) {
                   console.log(json[0].content)
                   for (i = 0; i < json.length; i++) {
                       // do something more...
                       $("#cate").append(
                          "<a id='"+json[i].id+"' href='javascript:changeCate("+json[i].id+");'>"+ json[i].categoryName +"<em style='display: none;'>" +
					   "</em></a>"
                       )
                   }
               });
           })

       })

		function changeCate(Id){

          categoryID=Id;

            fetch("/news/newslist?pageNum="+Page+"&pageSize="+pageSize+"&categoryId="+Id+"").then(function (response) {
                return response.json().then(function (json) {
                    console.log(json)
					$("#newstbody").html("")

                    for (i = 0; i < json.length; i++) {
                        // do something more...

                        $("#newstbody").append("<tr>" +
                            "<td class='t_1'>" + json[i].id + "</td>" +
                            "<td class='t_2'><a href=''>" + json[i].title + "</a></td>" +
                            "<td class='t_3'>2017-9-01</td>" +
                            "<td class='t_4'><div class='btn'><a href='javascript:changeNews("+JSON.stringify(json[i])+");' class='delete' >修改</a><a href='javascript:deletenews("+json[i].id+")'class='delete'>删除</a></div></td>" +
                            " </tr>"
                        )
                    }
                });
            })

		}

		function changePage(PageNum) {
			Page=PageNum;

			if (Page==1) {
                $("#page1").attr("class", "pagenumb cur");
                $("#page2").attr("class", "pagenumb");
                $("#page3").attr("class", "pagenumb");
            }
            else if (Page==2){
                $("#page1").attr("class", "pagenumb");
                $("#page2").attr("class", "pagenumb cur");
                $("#page3").attr("class", "pagenumb");
            }
            else if (Page==3){
                $("#page1").attr("class", "pagenumb");
                $("#page2").attr("class", "pagenumb");
                $("#page3").attr("class", "pagenumb cur");
            }

            changeCate(categoryID)
        }
        function de() {
		    if(Page>=1) {
                Page = Page - 1
                changePage(Page)
            }
		}
      function add() {
          Page = Page+1
          changePage(Page)
      }
        function deletenews(newsId) {

            fetch("/news/deleteNews?id="+newsId).then(function (response) {
                return response.json().then(function (json) {

                    alert("删除成功")
                    window.location.reload()
                });
            })
        }
	</script>
<script th:inline="javascript">
	 var newsId="";
     function changeNews(j) {

         $(".layuiBg").css({
             display:"block",height:$(document).height(),
         });
         $(".imgXgbox").css({
             left:($("body").width()-$(".imgXgbox").width())/2-20+"px",
             top:($(window).height()-$(".imgXgbox").height())/2+$(window).scrollTop()+"px",
             display:"block"
         });
         $("#title").attr("value",j.title)
		 $("#texts").attr("value",j.content)
		 $("#Newsimg").attr("src",j.url)
		 newsId=j.id
     }


     $("#savecate").click(function(){
        var catenew=$("#catenew").val();

         fetch("/category/addCategory?categoryName="+catenew).then(function (response) {
             return response.json().then(function (json) {

                 alert("添加成功")
                 window.location.reload()
             });
         })

     });

     $(document).ready( function() {
         fetch("/category/categoryList").then(function (response) {
             return response.json().then(function (json) {
                 for (i = 0; i < json.length; i++) {
                     // do something more...
                     var j=i+1;
                     $("#categoryId").append(
                         "<option value='"+j+"'>"+json[i].categoryName+"</option>"
                     )
                 }
             });
         })

     })
</script>
<script type="text/javascript">
	  var paths="";
	$("#upload").click(
	    function () {

            var form = new FormData();
            form.append('file',$("#fileImage")[0].files[0])

            $.ajax({
                url:"/news/upload",
                type:"POST",
                data:form,
                cache:false,
                processData:false,
                contentType:false,
                success:function(data){
                    paths=data
                   alert("成功上传")

                },
                error:function(e){
                    alert("错误！！");
                    window.clearInterval(timer);
                }
            });
        }
	)

	$("#updateNews").click(
          function () {
              var formData = new FormData();

              // 请求参数 ('key',value)
              formData.append('title', $("#title").val());
              formData.append('content',$("#texts").val());
              formData.append('url',paths);
              formData.append('categoryId',$("#categoryId").val())
              formData.append('id',newsId)

              fetch("/news/updateNews",{
                  method:'POST',
                  body:formData,

              }).then(function (response)

              {
                  return response.json().then(function (json) {
                      alert("修改成功")
                      window.location.reload()
                  });
              })
          }
      )


</script>


</body></html>