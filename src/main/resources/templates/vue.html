<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0130)file:///C:/Users/ckwin8/Documents/Tencent%20Files/598226095/FileRecv/uimaker%E5%90%8E%E5%8F%B0/uimaker%E5%90%8E%E5%8F%B0/chat.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>vue</title>
    <style>
        *, *:before, *:after {
            box-sizing: border-box;
        }
        body, html {
            height: 100%;
            overflow: hidden;
        }
        body, ul {
            margin: 0;
            padding: 0;
        }
        body {
            color: #4d4d4d;
            font: 14px/1.4em 'Helvetica Neue', Helvetica, 'Microsoft Yahei', Arial, sans-serif;
            background: #f5f5f5 url('dist/images/bg.jpg') no-repeat center;
            background-size: cover;
            font-smoothing: antialiased;
        }
        ul {
            list-style: none;
        }
        #chat {
            margin: 20px auto;
            width: 800px;
        	height: 600px;
        }
    </style>
	<style type="text/css">#chat{overflow:hidden;border-radius:3px}#chat .main,#chat .sidebar{height:100%}#chat .sidebar{float:left;width:200px;color:#f4f4f4;background-color:#2e3238}#chat .main{position:relative;overflow:hidden;background-color:#eee}#chat .m-text{position:absolute;width:100%;bottom:0;left:0}#chat .m-message{height:calc(100% - 10pc)}</style><style type="text/css">.m-card{padding:9pt;border-bottom:1px solid #24272c}.m-card footer{margin-top:10px}.m-card .avatar,.m-card .name{vertical-align:middle}.m-card .avatar{border-radius:2px}.m-card .name{display:inline-block;margin:0 0 0 15px;font-size:1pc}.m-card .search{padding:0 10px;width:100%;font-size:9pt;color:#fff;height:30px;line-height:30px;border:1px solid #3a3a3a;border-radius:4px;outline:0;background-color:#26292e}</style><style type="text/css">.m-list li{padding:9pt 15px;border-bottom:1px solid #292c33;cursor:pointer;-webkit-transition:background-color .1s;transition:background-color .1s}.m-list li:hover{background-color:hsla(0,0%,100%,.03)}.m-list li.active{background-color:hsla(0,0%,100%,.1)}.m-list .avatar,.m-list .name{vertical-align:middle}.m-list .avatar{border-radius:2px}.m-list .name{display:inline-block;margin:0 0 0 15px}</style><style type="text/css">.m-text{height:10pc;border-top:1px solid #ddd}.m-text textarea{padding:10px;height:100%;width:100%;border:none;outline:0;font-family:Micrsofot Yahei;resize:none}</style><style type="text/css">.m-message{padding:10px 15px;overflow-y:scroll}.m-message li{margin-bottom:15px}.m-message .time{margin:7px 0;text-align:center}.m-message .time>span{display:inline-block;padding:0 18px;font-size:9pt;color:#fff;border-radius:2px;background-color:#dcdcdc}.m-message .avatar{float:left;margin:0 10px 0 0;border-radius:3px}.m-message .text{display:inline-block;position:relative;padding:0 10px;max-width:calc(100% - 40px);min-height:30px;line-height:2.5;font-size:9pt;text-align:left;word-break:break-all;background-color:#fafafa;border-radius:4px}.m-message .text:before{content:" ";position:absolute;top:9px;right:100%;border:6px solid transparent;border-right-color:#fafafa}.m-message .self{text-align:right}.m-message .self .avatar{float:right;margin:0 0 0 10px}.m-message .self .text{background-color:#b2e281}.m-message .self .text:before{right:inherit;left:100%;border-right-color:transparent;border-left-color:#b2e281}</style>
	<link rel="stylesheet" href="/layui/css/layui.css" media="all">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
</head>


<body>

<div id="chat">

  <div class="sidebar">
    <div class="m-card">
      <header>
        <img class="avatar" width="40" height="40" alt="Coffce" src="/vue_files/1.jpg">
        <p id="me" class="name">Coffce</p></header>
      <footer>
        <input class="search" placeholder="search user..."></footer>
    </div>
    <!--v-component-->
    <div class="m-list">
      <ul>
        <!--v-for-start-->
        <li class="people" onclick="clickPeople(this)">
          <img class="avatar" width="30" height="30" alt="示例介绍" src="/vue_files/2.png">
          <p class="name">示例介绍</p>
		  <button class="layui-btn layui-btn-small layui-btn-primary">
			<i class="layui-icon" style="font-size: 30px; color: #1E9FFF;">&#x1006;</i>   
		  </button>
		</li>

      </ul>
    </div>
    <!--v-component--></div>
  <div class="main">
    <div class="m-message" >
      <ul id="m-message">
        </ul>
    </div>
    <!--v-component-->
    <div class="m-text">
      <textarea  style="height:80%" id="goingToSend" placeholder="请输入要发送的内容"></textarea>
	  <div class="layui-row">
		  <button class="layui-btn layui-col-md4 layui-col-md-offset2" onclick="endSession()">结束会话</button>
		  <button class="layui-btn layui-col-md4 layui-col-md-offset5" id="send" onclick="sendToServer()">发送</button>
	  </div>

    </div>
    <!--v-component--></div>
</div>

</body>

	<!--js-->
	<!--
	<script src="js/chat.js"/>
	<script src="layui/layui.js"/>
	-->
	

	
	<script>
		var end = 
		'<p class="time"> <span>${time}</span></p>'+
          '<div style="text-align:center;color:#FF0000">'+
           '已经结束会话'+
		  '</div>';
		  
		var left =
		'<li>'+
          '<p class="time">'+
            '<span>${time}</span></p>'+
          '<div class="main">'+
            '<img class="avatar" width="30" height="30" src="./vue_files/2.png">'+
            '<div class="text">${content}</div></div>'+
        '</li>';

		var right =
		'<li><p class="time">'+
		    '<span>${time}13:55</span>'+
		    '</p>'+
		    '<div class="main self"><img class="avatar" width="30" height="30" src="./vue_files/2.png">'+
		    '<div class="text">${content}</div></div></li>';


		var taskXun;
		var taskConnec;

		function sendToServer(){
		
			var content = $('#goingToSend')[0].value;
			var item = right.replace("${time}",new Date());
			item = item.replace("${content}",content);
			$("#m-message").append(item);
			
			$.ajax({
				url:'/cs/send',
				type:'POST', //GET
				async:true,    //或false,是否异步
				data:{
					content:content
				},
				timeout:5000,    //超时时间
				dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
				success:function(data){
					return;
				}
			})
			
		}
		
		
		function xun(){
		
			$.ajax({
				url:'/cs/getNewRecords',
				type:'GET', //GET
				async:true,    //或false,是否异步
				timeout:5000,    //超时时间
				dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
				success:function(data){
					if(data==null){//会话已经结束
						var item;
						item = end.replace("${time}",time);
						$("#m-message").append(item);
						return;
					}
					for(var i=0;i<data.length;i++){
						render(data[i]);
					}
					
					return;
				}
			})
		
		}
		
		function render(data){
					var time = data.sendtime;
					var content = data.content;
					var item;
					item = left.replace("${time}",time);
					item = item.replace("${content}",content);
					$("#m-message").append(item);
		}


		function endSession(){
		    var item = end.replace("${time}",new Date());
		    $.ajax({
                url:'/cs/endSession',
				type:'GET', //GET
				async:true,    //或false,是否异步
				timeout:5000,    //超时时间
				dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
				success:function(data){
				    $("#m-message").append(item);
				    window.clearInterval(taskXun);
                    taskConnec = window.setInterval("xunconnect()",500);
					return;
				}
		    })
		}


		function xunconnect(){
		    $.ajax({
                url:'/cs/xunconnect',
				type:'GET', //GET
				async:true,    //或false,是否异步
				timeout:5000,    //超时时间
				dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
				success:function(data){
				    if(data){//有连接
                        $("#m-message").innerHTML="";
                        window.clearInterval(taskConnec);
                        taskXun = window.setInterval("xun()",500);
				    }
					return;
				}
		    })
		}

		taskConnec = window.setInterval("xunconnect()",500);//一开始是没有会话的，所以轮询查看是否有连接进来

		</script>
		
		
<!--	
	var eleV;
		var messageV;
		var keyV;
		function clickPeople(ele){
			eleV = ele;
			
			if(isActive(ele)){
				return
			}
			alert("sdfdfhgf")
			var key = $('#me').innerHTML + "$$" + eleV.children[1].innerHTML
			alert("dfgfgjghk")
			keyV = $("#me").innerHTML + "$$" + eleV.children[1].innerHTML
			var localStorage = Window.localStorage
			var ui = localStorage.getItem(key)
			messageV = $(".m-message")[0]
			
		}
		
		
		function isActive(ele){
			var classList = ele.classList
			for(var i = 0;i<classList.length;i++){
				var clazz = classList[i]
				if(clazz == 'active'){
					alert("本来就是")
					return true
				}
			}
			return false
		}
	-->
	
</html>